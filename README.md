
Installs and configures a classic syslog-ng service for processing log files away from journald.

This again allows a simple, central logging service to be run on the user's own network.

**This role disables journald and takes over its function!**

[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/bodsch/ansible-syslog-ng/CI)][ci]
[![GitHub issues](https://img.shields.io/github/issues/bodsch/ansible-syslog-ng)][issues]
[![GitHub release (latest by date)](https://img.shields.io/github/v/release/bodsch/ansible-syslog-ng)][releases]

[ci]: https://github.com/bodsch/ansible-syslog-ng/actions
[issues]: https://github.com/bodsch/ansible-syslog-ng/issues?q=is%3Aopen+is%3Aissue
[releases]: https://github.com/bodsch/ansible-syslog-ng/releases


## tested operating systems

* Debian 9 / 10
* Ubuntu 18.04 / 20.04
* CentOS 8
* Oracle Linux 8
* Arch Linux

## usage

```
syslog_options_group: 'adm'

# The template to be used in all destination drivers expect usertty.
syslog_default_template: '${YEAR}-${MONTH}-${DAY}T${HOUR}:${MIN}:${SEC} ${LEVEL} ${MSGHDR}${MSG}\n'

# Should be added logs for grsecurity and PAX?
syslog_hardened: false

syslog_journald:
  wipe_persistent: true
  config:
    Storage: volatile
    ForwardToSyslog: 'yes'
```

### define logfiles

Additional log destinations to be merged with the [default](./vars/main.yml) (`syslog_logs_default`)  ones.

`syslog_logs`

A list of hashes that defines a trio of file destination, filter, log and
also a lograte.
a simplified configuration that is sufficient for most cases.

```
syslog_logs:
  - id:                  unique identifier (required)
    source:              source of logging messages - 'src', or 'kernsrc'; default is 'src'
    file_name:           log file relative to /var/log/; default is '${id}.log'
    filter:              filter expression; default is 'program(${id})'
    final:               whether set a final flag; default is false
    delete_after_days:   how many days to keep old logs (lograte); default is forever
```

**Example:**

```
syslog_logs:
  - id: iptables
    source: kernsrc
    file_name: iptables.log
    filter: message("^(\\[.*\..*\] |)ip6?tables.*")
    final: true
    delete_after_days: 365
```

This will produce:

-  `destination d_iptables    { file("/var/log/iptables.log" template(tmpl)); };`
-  `filter f_iptables    { message("^(\\[.*\..*\] |)ip6?tables.*"); };`
-  `log { source(kernsrc);  filter(f_iptables);  destination(d_iptables); flags(final); };`



### TODO
support remote host like this:

    `destination d_net { tcp("127.0.0.1" port(1000) log_fifo_size(1000)); };`


### define of sources

Additional log sources to be merged with the [default](./vars/main.yml) (`syslog_sources_default`) ones.

```
syslog_sources:
  src:              (unique identifier of the source (typically just 'src'))
    - comment:      an optional comment
      internal:     key is name of the source driver, typically unix_stream or file
                    (underscores are replaced with hyphens)
                    value is the driver parameter
```

**Example**

```
syslog_sources:
  src:
    - comment: messages generated by syslog-ng
      internal:
  kernsrc:
    - comment: messages from the kernel
      file: /proc/kmsg
```

## Tests

Tests can be performed with `molecule` and `tox`.
`tox` supports here with a test matrix, so that different Ansible versions can be used.

see also [Actions](https://github.com/bodsch/ansible-syslog-ng/actions)

```
$ tox -e py39-ansible210 -- molecule test

```

## License

[Apache](https://raw.githubusercontent.com/bodsch/ansible-logrotate/master/LICENSE)

