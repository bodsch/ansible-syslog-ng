
# Ansible Role:  `syslog-ng`


Installs and configures a classic syslog-ng service for processing log files away from journald.

This again allows a simple, central logging service to be run on the user's own network.

**This role disables journald and takes over its function!**

[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/bodsch/ansible-syslog-ng/CI)][ci]
[![GitHub issues](https://img.shields.io/github/issues/bodsch/ansible-syslog-ng)][issues]
[![GitHub release (latest by date)](https://img.shields.io/github/v/release/bodsch/ansible-syslog-ng)][releases]

[ci]: https://github.com/bodsch/ansible-syslog-ng/actions
[issues]: https://github.com/bodsch/ansible-syslog-ng/issues?q=is%3Aopen+is%3Aissue
[releases]: https://github.com/bodsch/ansible-syslog-ng/releases


## tested operating systems

Tested on

* ArchLinux
* ArtixLinux
* Debian based
    - Debian 10 / 11
    - Ubuntu 20.04

## usage

```yaml
syslog_options_group: 'adm'

syslog_systemd_template: default

syslog_logs: {}

syslog_sources:
  src:
    - comment: messages generated by syslog-ng
      system:

syslog_message_templates: {}

syslog_hardened: false

syslog_journald:
  wipe_persistent: true
  config:
    Storage: volatile
    ForwardToSyslog: 'yes'
```


### `syslog_logs`

Additional log destinations to be merged with the [default](./vars/main.yml) (`syslog_defaults_logs`)  ones.

`syslog_logs`

A list of hashes, a trio of file destination, filter, log.
A simplified configuration that should be sufficient for most cases.

| parameter           | required | default           | description                                      |
| :----               | :----    | :----             | :-----                                           |
| `source`            | `false`  | `src`             | source of logging messages - 'src', or 'kernsrc' |
| `file_name`         | `false`  | `${key}.log`      | log file relative to `/var/log`. (The basic directory is created automatically.) |
| `filter.name`       | `false`  | `${key}`          | An (optional) name of the filter. If it is not specified, the `${key}` is used as name. |
| `filter.filter`     | `false`  | `program(${key})` | The syslog filter. This can be a simple string or a list of strings.<br>The list is connected with an `and`.  |
| `final`             | `false`  | `false`           | whether set a final flag                         |


#### Example

```yaml
syslog_logs:
  kern:
    source: kernsrc
    file_name: kernel.log
    filter:
      name: kern
      filter: facility(kern)
  messages:
    file_name: messages.log
    filter:
      filter:
        - level(info..alert)
        - level(debug..notice)
        - not facility(auth, authpriv, mail, cron, kern, local7)
        - not program (syslog-ng)
        - not program (dhcpd)
        - not program(named)
  iptables:
    source: kernsrc
    file_name: iptables.log
    filter:
      filter: message("^(\\[.*\..*\] |)ip6?tables.*")
    final: true
  remote:
    source: net
    template: nginx
    file_name: "remote/nginx/${FULLHOST}.log"
```


### `syslog_sources`

Additional log sources to be merged with the [default](./vars/main.yml) (`syslog_defaults_sources`) ones.


| parameter           | description           |
| :----               | :-----                |
| `comment`           | an optional comment   |
| `$driver`           | key is name of the source driver, typically `unix_stream` or `file`<br>(underscores are replaced with hyphens)<br>value is the driver parameter |


#### Example

```yaml
syslog_sources:
  src:
    - comment: messages generated by syslog-ng
      internal:
  kernsrc:
    - comment: messages from the kernel
      file: /proc/kmsg
  net:
    - comment: messages from syslog-clients
      udp:
```


### `syslog_message_templates`

You can define your own templates for log files.
This makes it possible to give each log file a suitable output format.

By default, a template called `tmpl` is created, which is defined as follows:

`'${YEAR}-${MONTH}-${DAY}T${HOUR}:${MIN}:${SEC} ${LEVEL} ${MSGHDR}${MSG}\n'`

By default, each destrination is assigned this template.
If this is not desired, `use_template` must be set in the `syslog_logs` configuration.

```yaml
syslog_logs:
  ansible:
    file_name: ansible.log
    filter:
      filter: program(ansible)
    use_template: false
```

If a destination is to have its own output format, the defined template must be specified under `template`.

```yaml
syslog_message_templates:
  nginx: '${MSG}\n'

syslog_logs:
  remote:
    source: net
    template: ngix
    file_name: "remote/${FULLHOST}.log"
```

## TODO
support remote host like this:

    `destination d_net { tcp("127.0.0.1" port(1000) log_fifo_size(1000)); };`


## Contribution

Please read [Contribution](CONTRIBUTING.md)

## Development,  Branches (Git Tags)

The `master` Branch is my *Working Horse* includes the "latest, hot shit" and can be complete broken!

If you want to use something stable, please use a [Tagged Version](https://github.com/bodsch/ansible-syslog-ng/tags)!

---

## Author and License

- Bodo Schulz

## License

[Apache](LICENSE)

**FREE SOFTWARE, HELL YEAH!**
